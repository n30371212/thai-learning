<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPTFL æ³°èªå…¨èƒ½ç‰¹è¨“ v6 (çµ‚æ¥µç‰ˆ)</title>
    
    <!-- æ ¸å¿ƒå‡½å¼åº« -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* ç¿»ç‰Œå‹•ç•« */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* å­éŸ³é¡åˆ¥é¡è‰² (ä¸­/é«˜/ä½) */
        .class-mid { border-color: #16a34a; background-color: #f0fdf4; color: #16a34a; }
        .class-high { border-color: #dc2626; background-color: #fef2f2; color: #dc2626; }
        .class-low { border-color: #2563eb; background-color: #eff6ff; color: #2563eb; }
        
        /* æ¯éŸ³é¡åˆ¥é¡è‰² */
        .vowel-short { border-color: #f59e0b; background-color: #fffbeb; color: #92400e; }
        .vowel-long { border-color: #8b5cf6; background-color: #f5f3ff; color: #5b21b6; }
        .vowel-special { border-color: #ec4899; background-color: #fdf2f8; color: #9d174d; }

        /* è€ƒè©¦å€’æ•¸å‹•ç•« */
        @keyframes pulse-red {
            0%, 100% { color: #ef4444; }
            50% { color: #7f1d1d; }
        }
        .animate-timer { animation: pulse-red 1s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-yellow-50 text-gray-800 h-screen overflow-hidden font-sans select-none">

    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 0. å…¨åŸŸå·¥å…·å‡½å¼ ---
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const playAudio = (text) => {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH'; 
            utterance.rate = 0.8; 
            window.speechSynthesis.speak(utterance);
        };

        // --- 1. å®Œæ•´è³‡æ–™åº« ---
        const rawVocabData = [
            { id: 1, thai: 'à¸ªà¸§à¸±à¸ªà¸”à¸µ', pinyin: 'sa-wat-dee', meaning: 'ä½ å¥½', category: 'å•å€™' },
            { id: 2, thai: 'à¸‚à¸­à¸šà¸„à¸¸à¸“', pinyin: 'khop-khun', meaning: 'è¬è¬', category: 'å•å€™' },
            { id: 3, thai: 'à¸‚à¸­à¹‚à¸—à¸©', pinyin: 'kho-thot', meaning: 'å°ä¸èµ·', category: 'å•å€™' },
            { id: 4, thai: 'à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™à¹„à¸£', pinyin: 'mai pen rai', meaning: 'æ²’é—œä¿‚', category: 'å¸¸ç”¨' },
            { id: 5, thai: 'à¹ƒà¸Šà¹ˆ', pinyin: 'chai', meaning: 'æ˜¯/å°', category: 'å¸¸ç”¨' },
            { id: 6, thai: 'à¹„à¸¡à¹ˆ', pinyin: 'mai', meaning: 'ä¸/æ²’æœ‰', category: 'å¸¸ç”¨' },
            { id: 7, thai: 'à¸œà¸¡', pinyin: 'phom', meaning: 'æˆ‘ (ç”·)', category: 'ä»£è©' },
            { id: 8, thai: 'à¸‰à¸±à¸™', pinyin: 'chan', meaning: 'æˆ‘ (å¥³)', category: 'ä»£è©' },
            { id: 9, thai: 'à¸„à¸¸à¸“', pinyin: 'khun', meaning: 'ä½ ', category: 'ä»£è©' },
            { id: 10, thai: 'à¹€à¸‚à¸²', pinyin: 'khao', meaning: 'ä»–/å¥¹', category: 'ä»£è©' },
            { id: 11, thai: 'à¸­à¸°à¹„à¸£', pinyin: 'a-rai', meaning: 'ä»€éº¼', category: 'ç–‘å•' },
            { id: 12, thai: 'à¸—à¸µà¹ˆà¹„à¸«à¸™', pinyin: 'tee nai', meaning: 'åœ¨å“ªè£¡', category: 'ç–‘å•' },
            { id: 13, thai: 'à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆ', pinyin: 'muea rai', meaning: 'ä»€éº¼æ™‚å€™', category: 'ç–‘å•' },
            { id: 14, thai: 'à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ', pinyin: 'thao-rai', meaning: 'å¤šå°‘éŒ¢', category: 'ç–‘å•' },
            { id: 15, thai: 'à¹ƒà¸„à¸£', pinyin: 'khrai', meaning: 'èª°', category: 'ç–‘å•' },
            { id: 16, thai: 'à¸à¸´à¸™', pinyin: 'gin', meaning: 'åƒ', category: 'å‹•è©' },
            { id: 17, thai: 'à¸”à¸·à¹ˆà¸¡', pinyin: 'duem', meaning: 'å–', category: 'å‹•è©' },
            { id: 18, thai: 'à¹„à¸›', pinyin: 'pai', meaning: 'å»', category: 'å‹•è©' },
            { id: 19, thai: 'à¸¡à¸²', pinyin: 'ma', meaning: 'ä¾†', category: 'å‹•è©' },
            { id: 20, thai: 'à¸Šà¸­à¸š', pinyin: 'chob', meaning: 'å–œæ­¡', category: 'å‹•è©' },
            { id: 21, thai: 'à¸£à¸±à¸', pinyin: 'rak', meaning: 'æ„›', category: 'å‹•è©' },
            { id: 22, thai: 'à¸—à¸³', pinyin: 'tham', meaning: 'åš', category: 'å‹•è©' },
            { id: 23, thai: 'à¸”à¸¹', pinyin: 'du', meaning: 'çœ‹', category: 'å‹•è©' },
            { id: 24, thai: 'à¸Ÿà¸±à¸‡', pinyin: 'fang', meaning: 'è½', category: 'å‹•è©' },
            { id: 25, thai: 'à¸à¸¹à¸”', pinyin: 'phut', meaning: 'èªª', category: 'å‹•è©' },
            { id: 26, thai: 'à¸™à¸­à¸™', pinyin: 'non', meaning: 'ç¡è¦º', category: 'å‹•è©' },
            { id: 27, thai: 'à¹€à¸­à¸²', pinyin: 'ao', meaning: 'è¦ (ç‰©å“)', category: 'å‹•è©' },
            { id: 28, thai: 'à¸šà¹‰à¸²à¸™', pinyin: 'baan', meaning: 'å®¶', category: 'åœ°é»' },
            { id: 29, thai: 'à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™', pinyin: 'rong-rian', meaning: 'å­¸æ ¡', category: 'åœ°é»' },
            { id: 30, thai: 'à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³', pinyin: 'hong nam', meaning: 'æ´—æ‰‹é–“', category: 'åœ°é»' },
            { id: 31, thai: 'à¸£à¹‰à¸²à¸™à¸­à¸²à¸«à¸²à¸£', pinyin: 'ran a-han', meaning: 'é¤å»³', category: 'åœ°é»' },
            { id: 32, thai: 'à¸™à¹‰à¸³', pinyin: 'nam', meaning: 'æ°´', category: 'é£²é£Ÿ' },
            { id: 33, thai: 'à¸‚à¹‰à¸²à¸§', pinyin: 'khao', meaning: 'é£¯', category: 'é£²é£Ÿ' },
            { id: 34, thai: 'à¹€à¸‡à¸´à¸™', pinyin: 'ngoen', meaning: 'éŒ¢', category: 'ç‰©å“' },
            { id: 35, thai: 'à¸‡à¸²à¸™', pinyin: 'ngan', meaning: 'å·¥ä½œ', category: 'ç‰©å“' },
            { id: 36, thai: 'à¸ªà¸§à¸¢', pinyin: 'suay', meaning: 'æ¼‚äº®', category: 'å½¢å®¹' },
            { id: 37, thai: 'à¸­à¸£à¹ˆà¸­à¸¢', pinyin: 'a-roi', meaning: 'å¥½åƒ', category: 'å½¢å®¹' },
            { id: 38, thai: 'à¸£à¹‰à¸­à¸™', pinyin: 'ron', meaning: 'ç†±', category: 'å½¢å®¹' },
            { id: 39, thai: 'à¸«à¸™à¸²à¸§', pinyin: 'nao', meaning: 'å†·', category: 'å½¢å®¹' },
            { id: 40, thai: 'à¹ƒà¸«à¸à¹ˆ', pinyin: 'yai', meaning: 'å¤§', category: 'å½¢å®¹' },
            { id: 41, thai: 'à¹€à¸¥à¹‡à¸', pinyin: 'lek', meaning: 'å°', category: 'å½¢å®¹' },
            { id: 42, thai: 'à¹€à¸œà¹‡à¸”', pinyin: 'phet', meaning: 'è¾£', category: 'å½¢å®¹' },
            { id: 43, thai: 'à¸«à¸™à¸¶à¹ˆà¸‡', pinyin: 'nueng', meaning: 'ä¸€ (1)', category: 'æ•¸å­—' },
            { id: 44, thai: 'à¸ªà¸­à¸‡', pinyin: 'song', meaning: 'äºŒ (2)', category: 'æ•¸å­—' },
            { id: 45, thai: 'à¸ªà¸²à¸¡', pinyin: 'sam', meaning: 'ä¸‰ (3)', category: 'æ•¸å­—' },
            { id: 46, thai: 'à¸ªà¸µà¹ˆ', pinyin: 'si', meaning: 'å›› (4)', category: 'æ•¸å­—' },
            { id: 47, thai: 'à¸«à¹‰à¸²', pinyin: 'ha', meaning: 'äº” (5)', category: 'æ•¸å­—' },
            { id: 48, thai: 'à¸ªà¸´à¸š', pinyin: 'sip', meaning: 'å (10)', category: 'æ•¸å­—' },
            { id: 49, thai: 'à¸£à¹‰à¸­à¸¢', pinyin: 'roi', meaning: 'ç™¾ (100)', category: 'æ•¸å­—' },
            { id: 50, thai: 'à¸§à¸±à¸™à¸™à¸µà¹‰', pinyin: 'wan-nee', meaning: 'ä»Šå¤©', category: 'æ™‚é–“' },
        ];

        const consonantData = [
            { char: 'à¸', name: 'ko kai', class: 'mid', meaning: 'é›' },
            { char: 'à¸‚', name: 'kho khai', class: 'high', meaning: 'è›‹' },
            { char: 'à¸ƒ', name: 'kho khuat', class: 'high', meaning: 'ç“¶' },
            { char: 'à¸„', name: 'kho khwai', class: 'low', meaning: 'æ°´ç‰›' },
            { char: 'à¸…', name: 'kho khon', class: 'low', meaning: 'äºº' },
            { char: 'à¸†', name: 'kho ra-khang', class: 'low', meaning: 'é˜' },
            { char: 'à¸‡', name: 'ngo ngu', class: 'low', meaning: 'è›‡' },
            { char: 'à¸ˆ', name: 'jo jan', class: 'mid', meaning: 'ç›¤å­' },
            { char: 'à¸‰', name: 'cho ching', class: 'high', meaning: 'éˆ¸' },
            { char: 'à¸Š', name: 'cho chang', class: 'low', meaning: 'å¤§è±¡' },
            { char: 'à¸‹', name: 'so so', class: 'low', meaning: 'é–éˆ' },
            { char: 'à¸Œ', name: 'cho choe', class: 'low', meaning: 'æ¨¹' },
            { char: 'à¸', name: 'yo ying', class: 'low', meaning: 'å¥³äºº' },
            { char: 'à¸”', name: 'do dek', class: 'mid', meaning: 'å°å­©' },
            { char: 'à¸•', name: 'to tao', class: 'mid', meaning: 'çƒé¾œ' },
            { char: 'à¸–', name: 'tho thung', class: 'high', meaning: 'è¢‹å­' },
            { char: 'à¸—', name: 'tho thahan', class: 'low', meaning: 'å£«å…µ' },
            { char: 'à¸˜', name: 'tho thong', class: 'low', meaning: 'æ——' },
            { char: 'à¸™', name: 'no nu', class: 'low', meaning: 'è€é¼ ' },
            { char: 'à¸š', name: 'bo baimai', class: 'mid', meaning: 'è‘‰å­' },
            { char: 'à¸›', name: 'po pla', class: 'mid', meaning: 'é­š' },
            { char: 'à¸œ', name: 'pho phueng', class: 'high', meaning: 'èœœèœ‚' },
            { char: 'à¸', name: 'fo fa', class: 'high', meaning: 'è“‹å­' },
            { char: 'à¸', name: 'pho phan', class: 'low', meaning: 'ç›¤å­' },
            { char: 'à¸Ÿ', name: 'fo fan', class: 'low', meaning: 'ç‰™é½’' },
            { char: 'à¸ ', name: 'pho sam-phao', class: 'low', meaning: 'å¸†èˆ¹' },
            { char: 'à¸¡', name: 'mo ma', class: 'low', meaning: 'é¦¬' },
            { char: 'à¸¢', name: 'yo yak', class: 'low', meaning: 'å·¨äºº' },
            { char: 'à¸£', name: 'ro ruea', class: 'low', meaning: 'èˆ¹' },
            { char: 'à¸¥', name: 'lo ling', class: 'low', meaning: 'çŒ´å­' },
            { char: 'à¸§', name: 'wo waen', class: 'low', meaning: 'æˆ’æŒ‡' },
            { char: 'à¸¨', name: 'so sala', class: 'high', meaning: 'æ¶¼äº­' },
            { char: 'à¸©', name: 'so rue-si', class: 'high', meaning: 'éš±å£«' },
            { char: 'à¸ª', name: 'so suea', class: 'high', meaning: 'è€è™' },
            { char: 'à¸«', name: 'ho hip', class: 'high', meaning: 'ç®±å­' },
            { char: 'à¸¬', name: 'lo chu-la', class: 'low', meaning: 'é¢¨ç®' },
            { char: 'à¸­', name: 'o ang', class: 'mid', meaning: 'ç›†' },
            { char: 'à¸®', name: 'ho nok-huk', class: 'low', meaning: 'è²“é ­é·¹' },
        ];

        const vowelData = [
            { char: '-à¸°', name: 'sara a', type: 'short' },
            { char: '-à¸²', name: 'sara aa', type: 'long' },
            { char: 'à¸­à¸´', name: 'sara i', type: 'short' },
            { char: 'à¸­à¸µ', name: 'sara ii', type: 'long' },
            { char: 'à¸­à¸¶', name: 'sara ue', type: 'short' },
            { char: 'à¸­à¸·', name: 'sara uue', type: 'long' },
            { char: 'à¸­à¸¸', name: 'sara u', type: 'short' },
            { char: 'à¸­à¸¹', name: 'sara uu', type: 'long' },
            { char: 'à¹€-à¸°', name: 'sara e', type: 'short' },
            { char: 'à¹€-', name: 'sara ee', type: 'long' },
            { char: 'à¹-à¸°', name: 'sara ae', type: 'short' },
            { char: 'à¹-', name: 'sara aae', type: 'long' },
            { char: 'à¹‚-à¸°', name: 'sara o', type: 'short' },
            { char: 'à¹‚-', name: 'sara oo', type: 'long' },
            { char: 'à¹€-à¸²à¸°', name: 'sara or', type: 'short' },
            { char: '-à¸­', name: 'sara oor', type: 'long' },
            { char: 'à¹€-à¸­à¸°', name: 'sara oe', type: 'short' },
            { char: 'à¹€-à¸­', name: 'sara ooe', type: 'long' },
            { char: 'à¹€-à¸µà¸¢à¸°', name: 'sara ia (çŸ­)', type: 'short' },
            { char: 'à¹€-à¸µà¸¢', name: 'sara iia (é•·)', type: 'long' },
            { char: 'à¹€-à¸·à¸­à¸°', name: 'sara uea (çŸ­)', type: 'short' },
            { char: 'à¹€-à¸·à¸­', name: 'sara uuea (é•·)', type: 'long' },
            { char: 'à¸­à¸±à¸§à¸°', name: 'sara ua (çŸ­)', type: 'short' },
            { char: 'à¸­à¸±à¸§', name: 'sara uua (é•·)', type: 'long' },
            { char: 'à¸³', name: 'sara am', type: 'special' },
            { char: 'à¹ƒ', name: 'mai muan (ai)', type: 'special' },
            { char: 'à¹„', name: 'mai malai (ai)', type: 'special' },
            { char: 'à¹€-à¸²', name: 'sara ao', type: 'special' },
        ];

        // --- 2. å„å€‹åŠŸèƒ½é é¢å…ƒä»¶ ---

        // [é é¢] é¦–é 
        const HomeScreen = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center h-full space-y-6 p-4 animate-fade-in bg-yellow-50">
                <div className="text-center">
                    <h1 className="text-4xl md:text-5xl font-extrabold text-yellow-600 mb-2">ğŸ‡¹ğŸ‡­ CPTFL ç‰¹è¨“</h1>
                    <p className="text-gray-500">å…¨åŠŸèƒ½æ•´åˆç‰ˆ (All-in-One)</p>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-md">
                    {/* å­¸ç¿’å€ */}
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                        <h3 className="text-gray-400 text-xs uppercase tracking-wider mb-2 font-bold">åŸºç¤å­¸ç¿’</h3>
                        <div className="grid grid-cols-2 gap-2">
                            <button onClick={() => onStart('learn')} className="p-3 bg-blue-50 text-blue-700 rounded-lg font-bold hover:bg-blue-100 transition">å–®å­—å¡</button>
                            <button onClick={() => onStart('rules')} className="p-3 bg-purple-50 text-purple-700 rounded-lg font-bold hover:bg-purple-100 transition">è²èª¿è¡¨</button>
                            <button onClick={() => onStart('alphabet')} className="p-3 bg-pink-50 text-pink-700 rounded-lg font-bold hover:bg-pink-100 transition col-span-2">å­—æ¯ç™¼éŸ³ (44+32)</button>
                        </div>
                    </div>

                    {/* æ¸¬é©—å€ */}
                    <div className="bg-white p-4 rounded-2xl shadow-lg border-2 border-yellow-400 relative overflow-hidden">
                        <div className="absolute top-0 right-0 bg-yellow-400 text-white text-xs px-2 py-1 rounded-bl-lg font-bold">æ¨è–¦</div>
                        <h3 className="text-yellow-600 text-xs uppercase tracking-wider mb-2 font-bold">æ¸¬é©—æ¨¡å¼</h3>
                        <div className="space-y-2">
                            <button onClick={() => onStart('quiz')} className="w-full p-3 bg-green-50 text-green-700 rounded-lg font-bold hover:bg-green-100 transition flex justify-between items-center">
                                <span>éš¨æ©Ÿç·´ç¿’</span> <span className="text-xs opacity-50">æœ‰æç¤º/å›é¥‹</span>
                            </button>
                            <button onClick={() => onStart('examIntro')} className="w-full p-3 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition shadow-md flex justify-between items-center group">
                                <span>ğŸ† å¯¦æˆ°æ¨¡æ“¬è€ƒ</span> <span className="text-xs bg-white/20 px-2 py-1 rounded group-hover:bg-white/30">é™æ™‚/ç„¡æ‹¼éŸ³</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );

        // [é é¢] å­—æ¯è¡¨ (ä¾†è‡ª v4)
        const AlphabetScreen = ({ onBack }) => {
            const [tab, setTab] = useState('consonant'); 
            return (
                <div className="flex flex-col h-full max-w-3xl mx-auto p-4 bg-white">
                    <div className="flex items-center justify-between mb-4">
                         <button onClick={onBack} className="text-gray-500 hover:bg-gray-100 px-3 py-1 rounded">â¬…ï¸ é¦–é </button>
                         <div className="bg-gray-200 p-1 rounded-lg flex text-sm">
                            <button onClick={() => setTab('consonant')} className={`px-4 py-1 rounded-md transition ${tab === 'consonant' ? 'bg-white shadow text-yellow-700 font-bold' : 'text-gray-500'}`}>å­éŸ³</button>
                            <button onClick={() => setTab('vowel')} className={`px-4 py-1 rounded-md transition ${tab === 'vowel' ? 'bg-white shadow text-yellow-700 font-bold' : 'text-gray-500'}`}>æ¯éŸ³</button>
                         </div>
                    </div>
                    <div className="flex-1 overflow-y-auto grid grid-cols-4 md:grid-cols-6 gap-2 pb-4 content-start">
                        {tab === 'consonant' ? (
                            consonantData.map((item, idx) => (
                                <button key={idx} onClick={() => playAudio(item.char)} className={`p-2 rounded-xl border-2 flex flex-col items-center justify-center aspect-square hover:scale-105 transition shadow-sm class-${item.class}`}>
                                    <span className="text-3xl font-bold mb-1">{item.char}</span>
                                    <span className="text-[10px] opacity-70">{item.name}</span>
                                </button>
                            ))
                        ) : (
                            vowelData.map((item, idx) => (
                                <button key={idx} onClick={() => playAudio(item.char.replace(/-/g, 'à¸­'))} className={`p-2 rounded-xl border-2 flex flex-col items-center justify-center aspect-square hover:scale-105 transition shadow-sm vowel-${item.type}`}>
                                    <span className="text-2xl font-bold mb-1">{item.char}</span>
                                    <span className="text-[10px] opacity-70 text-center leading-tight">{item.name}</span>
                                </button>
                            ))
                        )}
                    </div>
                    <div className="text-center text-[10px] text-gray-400 mt-2">
                        {tab === 'consonant' ? "â— ä¸­(ç¶ ) â— é«˜(ç´…) â— ä½(è—)" : "â— çŸ­(é»ƒ) â— é•·(ç´«) â— ç‰¹æ®Š(ç²‰)"}
                    </div>
                </div>
            );
        };

        // [é é¢] è²èª¿è¦å‰‡ (ä¾†è‡ª v4)
        const RulesScreen = ({ onBack }) => (
            <div className="max-w-4xl mx-auto h-full overflow-y-auto p-4 pb-10 bg-white">
                <button onClick={onBack} className="mb-4 text-gray-500 hover:bg-gray-100 px-3 py-1 rounded">â¬…ï¸ é¦–é </button>
                
                <div className="bg-white p-5 rounded-2xl shadow-sm mb-6 border border-gray-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">1. æœ‰è²èª¿ç¬¦è™Ÿ (Tone Marks)</h2>
                    <p className="text-sm text-gray-500 mb-4">ä¸­å­éŸ³æœ€å¼·ï¼Œèƒ½ç”¨å…¨éƒ¨ç¬¦è™Ÿã€‚</p>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-center border-collapse">
                            <thead>
                                <tr className="bg-gray-100 text-gray-600">
                                    <th className="p-2 border text-left">å­éŸ³</th>
                                    <th className="p-2 border">à¹ˆ (Mai Ek)</th>
                                    <th className="p-2 border">à¹‰ (Mai Tho)</th>
                                    <th className="p-2 border bg-yellow-50">à¹Š (Tri)</th>
                                    <th className="p-2 border bg-yellow-50">à¹‹ (Chattawa)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td className="p-3 border font-bold text-green-600 text-left">ä¸­ (Mid)</td><td className="p-3 border">Low (2)</td><td className="p-3 border">Falling (3)</td><td className="p-3 border bg-green-50 font-bold">High (4)</td><td className="p-3 border bg-green-50 font-bold">Rising (5)</td></tr>
                                <tr><td className="p-3 border font-bold text-red-600 text-left">é«˜ (High)</td><td className="p-3 border">Low (2)</td><td className="p-3 border">Falling (3)</td><td className="p-3 border text-gray-300">-</td><td className="p-3 border text-gray-300">-</td></tr>
                                <tr><td className="p-3 border font-bold text-blue-600 text-left">ä½ (Low)</td><td className="p-3 border font-bold text-purple-600">Falling (3)</td><td className="p-3 border font-bold text-purple-600">High (4)</td><td className="p-3 border text-gray-300">-</td><td className="p-3 border text-gray-300">-</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">2. ç„¡è²èª¿ç¬¦è™Ÿ (No Mark)</h2>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-center border-collapse">
                            <thead>
                                <tr className="bg-gray-100 text-gray-600">
                                    <th className="p-2 border text-left">å­éŸ³</th>
                                    <th className="p-2 border">å¹³éŸ³ (Live)</th>
                                    <th className="p-2 border">æ­»éŸ³ (Dead)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td className="p-3 border font-bold text-green-600 text-left">ä¸­ (Mid)</td> <td className="p-3 border">Mid (1)</td> <td className="p-3 border">Low (2)</td></tr>
                                <tr><td className="p-3 border font-bold text-red-600 text-left">é«˜ (High)</td> <td className="p-3 border font-bold text-purple-600">Rising (5)</td> <td className="p-3 border">Low (2)</td></tr>
                                <tr><td className="p-3 border font-bold text-blue-600 text-left">ä½ (Low)</td> <td className="p-3 border">Mid (1)</td> <td className="p-3 border text-left pl-4"><span className="block text-xs text-gray-500">çŸ­æ¯éŸ³: High (4)</span><span className="block text-xs text-gray-500">é•·æ¯éŸ³: Falling (3)</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        );

        // [é é¢] å–®å­—å¡å­¸ç¿’ (éš¨æ©Ÿæ´—ç‰Œ)
        const LearnScreen = ({ onBack }) => {
            const [cards, setCards] = useState([]); 
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [showPinyin, setShowPinyin] = useState(true);
            
            useEffect(() => { setCards(shuffleArray(rawVocabData)); }, []);
            
            if (cards.length === 0) return <div>Loading...</div>;
            const card = cards[currentIndex];
            const changeCard = (dir) => {
                setIsFlipped(false);
                setTimeout(() => setCurrentIndex((prev) => (prev + dir + cards.length) % cards.length), 200);
            };

            return (
                <div className="flex flex-col h-full max-w-md mx-auto p-4 bg-white">
                    <div className="flex justify-between items-center mb-4">
                        <button onClick={onBack} className="text-gray-500 hover:bg-gray-100 px-3 py-1 rounded">â¬…ï¸ é€€å‡º</button>
                        <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-bold">{currentIndex + 1} / {cards.length}</span>
                    </div>
                    <div className="flex-1 flex flex-col justify-center perspective-1000 my-2">
                        <div onClick={() => setIsFlipped(!isFlipped)} className={`relative w-full h-80 bg-gray-50 border-2 border-gray-100 rounded-3xl shadow-xl cursor-pointer transition-all duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                            <div className={`absolute inset-0 flex flex-col items-center justify-center backface-hidden p-6 ${isFlipped ? 'hidden' : 'flex'}`}>
                                <span className="text-sm text-gray-400 uppercase tracking-wider mb-2">{card.category}</span>
                                <h2 className="text-5xl font-bold text-gray-800 mb-4 text-center leading-tight">{card.thai}</h2>
                                {showPinyin ? <p className="text-xl text-blue-500 font-medium">{card.pinyin}</p> : <div className="h-7 w-32 bg-gray-200 rounded animate-pulse"></div>}
                                <button onClick={(e) => { e.stopPropagation(); playAudio(card.thai); }} className="mt-6 p-3 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-700 transition">ğŸ”Š</button>
                                <p className="text-xs text-gray-400 mt-auto pt-4">é»æ“Šç¿»é¢</p>
                            </div>
                            <div className={`absolute inset-0 flex flex-col items-center justify-center backface-hidden p-6 bg-blue-50 rounded-3xl ${isFlipped ? 'flex' : 'hidden'}`} style={{ transform: 'rotateY(180deg)' }}>
                                <h3 className="text-3xl font-bold text-gray-800 mb-2">{card.meaning}</h3>
                            </div>
                        </div>
                    </div>
                    <div className="space-y-4">
                        <div className="flex justify-center gap-4">
                            <button onClick={() => changeCard(-1)} className="px-6 py-3 bg-gray-200 rounded-xl font-bold text-gray-600">ä¸Šä¸€å€‹</button>
                            <button onClick={() => changeCard(1)} className="px-6 py-3 bg-blue-500 rounded-xl font-bold text-white shadow-lg">ä¸‹ä¸€å€‹</button>
                        </div>
                        <button onClick={() => setShowPinyin(!showPinyin)} className="w-full text-center text-sm text-gray-500 py-2">{showPinyin ? 'ğŸ‘ï¸ éš±è—æ‹¼éŸ³' : 'ğŸ‘ï¸â€ğŸ—¨ï¸ é¡¯ç¤ºæ‹¼éŸ³'}</button>
                    </div>
                </div>
            );
        };

        // [é é¢] éš¨æ©Ÿç·´ç¿’æ¸¬é©— (å³æ™‚å›é¥‹)
        const PracticeQuizScreen = ({ onBack }) => {
            const [qIndex, setQIndex] = useState(0);
            const [questions] = useState(() => shuffleArray(rawVocabData));
            const [options, setOptions] = useState([]);
            const [selected, setSelected] = useState(null);
            
            useEffect(() => {
                if (qIndex < questions.length) {
                    const correct = questions[qIndex];
                    const others = rawVocabData.filter(d => d.id !== correct.id).sort(()=>0.5-Math.random()).slice(0,3);
                    setOptions(shuffleArray([...others, correct]));
                }
            }, [qIndex]);

            const handleAns = (meaning) => {
                playAudio(questions[qIndex].thai);
                setSelected(meaning);
                setTimeout(() => {
                    if(qIndex < questions.length-1) { setQIndex(qIndex+1); setSelected(null); }
                    else { alert("ç·´ç¿’çµæŸï¼"); onBack(); }
                }, 1500);
            };

            if (qIndex >= questions.length) return null;

            return (
                <div className="flex flex-col h-full p-4 bg-green-50 max-w-md mx-auto">
                   <button onClick={onBack} className="self-start text-gray-500 mb-4 hover:bg-green-100 px-3 py-1 rounded">â¬…ï¸ é€€å‡ºç·´ç¿’</button>
                   <div className="w-full bg-gray-200 h-2 rounded-full mb-4"><div className="bg-green-500 h-2 rounded-full transition-all" style={{width: `${(qIndex/questions.length)*100}%`}}></div></div>
                   
                   <div className="flex-1 flex flex-col justify-center text-center">
                        <h2 className="text-6xl font-bold text-green-800 mb-8">{questions[qIndex].thai}</h2>
                        <p className="text-gray-500 mb-6">é¸æ“‡æ­£ç¢ºæ„æ€ (å³æ™‚ç™¼éŸ³)</p>
                        <div className="grid gap-3">
                            {options.map((opt, i) => (
                                <button key={i} onClick={() => handleAns(opt.meaning)} disabled={selected!==null}
                                    className={`p-4 rounded-xl border-2 text-lg font-bold transition ${
                                        selected === null ? 'bg-white border-green-100 hover:border-green-400' :
                                        opt.meaning === questions[qIndex].meaning ? 'bg-green-500 text-white border-green-600' :
                                        opt.meaning === selected ? 'bg-red-500 text-white border-red-600' : 'bg-white opacity-30'
                                    }`}
                                >{opt.meaning}</button>
                            ))}
                        </div>
                   </div>
                </div>
            );
        };

        // [é é¢] æ¨¡æ“¬è€ƒ - è¦å‰‡èªªæ˜
        const ExamIntroScreen = ({ onStart, onBack }) => (
            <div className="flex flex-col items-center justify-center h-full p-6 bg-gray-900 text-white">
                <div className="max-w-md text-center space-y-6 animate-fade-in">
                    <div className="text-6xl mb-4">âš ï¸</div>
                    <h2 className="text-3xl font-bold text-red-400">è€ƒè©¦è¦å‰‡èªªæ˜</h2>
                    <div className="text-left bg-gray-800 p-6 rounded-xl space-y-3 text-sm md:text-base border border-gray-700">
                        <p className="flex items-center gap-2">â±ï¸ <span className="font-bold">é™æ™‚æ¸¬é©—ï¼š</span> ç¸½å…± 20 é¡Œï¼Œ5 åˆ†é˜ã€‚</p>
                        <p className="flex items-center gap-2">ğŸš« <span className="font-bold text-red-300">ç¦æ­¢æ‹¼éŸ³ï¼š</span> å…¨ç¨‹ä¸é¡¯ç¤º Romanizationã€‚</p>
                        <p className="flex items-center gap-2">ğŸ§ <span className="font-bold text-yellow-300">Part 1 è½åŠ›ï¼š</span> åªæœ‰è²éŸ³ï¼Œæ²’æœ‰æ–‡å­—ã€‚</p>
                        <p className="flex items-center gap-2">ğŸ“– <span className="font-bold text-blue-300">Part 2 é–±è®€ï¼š</span> åªæœ‰æ³°æ–‡ï¼Œé¸å‡ºæ„æ€ã€‚</p>
                        <p className="flex items-center gap-2">ğŸ˜¶ <span className="font-bold">ç„¡å³æ™‚å›é¥‹ï¼š</span> è€ƒå®Œæ‰é¡¯ç¤ºæˆç¸¾ã€‚</p>
                    </div>
                    <div className="pt-6 flex gap-4 justify-center">
                        <button onClick={onBack} className="px-6 py-3 rounded-full border border-gray-600 hover:bg-gray-800 transition">æˆ‘æ€•äº†</button>
                        <button onClick={onStart} className="px-8 py-3 rounded-full bg-red-600 font-bold hover:bg-red-500 shadow-lg shadow-red-900/50 transition animate-pulse">é–‹å§‹è€ƒè©¦</button>
                    </div>
                </div>
            </div>
        );

        // [é é¢] æ¨¡æ“¬è€ƒ - é€²è¡Œä¸­
        const ExamScreen = ({ onFinish }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState([]); 
            const [timeLeft, setTimeLeft] = useState(300); 
            const [options, setOptions] = useState([]);
            
            useEffect(() => {
                const shuffled = shuffleArray(rawVocabData);
                const listeningPart = shuffled.slice(0, 10).map(q => ({...q, type: 'listening'}));
                const readingPart = shuffled.slice(10, 20).map(q => ({...q, type: 'reading'}));
                setQuestions([...listeningPart, ...readingPart]);
            }, []);

            useEffect(() => {
                if (timeLeft > 0) {
                    const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                    return () => clearTimeout(timer);
                } else {
                    onFinish(userAnswers, questions); 
                }
            }, [timeLeft, userAnswers]);

            useEffect(() => {
                if (questions.length > 0 && currentIndex < questions.length) {
                    const currentQ = questions[currentIndex];
                    if (currentQ.type === 'listening') setTimeout(() => playAudio(currentQ.thai), 500);
                    
                    const distractors = rawVocabData.filter(item => item.id !== currentQ.id).sort(() => 0.5 - Math.random()).slice(0, 3);
                    setOptions(shuffleArray([...distractors, currentQ]));
                }
            }, [currentIndex, questions]);

            const handleAnswer = (choiceMeaning) => {
                const currentQ = questions[currentIndex];
                const newAnswers = [...userAnswers, { question: currentQ, userChoice: choiceMeaning, isCorrect: choiceMeaning === currentQ.meaning }];
                setUserAnswers(newAnswers);
                if (currentIndex + 1 < questions.length) setCurrentIndex(currentIndex + 1);
                else onFinish(newAnswers, questions);
            };

            if (questions.length === 0) return <div className="h-full flex items-center justify-center text-white bg-gray-900">è¼‰å…¥è©¦å·ä¸­...</div>;
            const currentQ = questions[currentIndex];
            const isListening = currentQ.type === 'listening';

            return (
                <div className="flex flex-col h-full bg-gray-100 text-gray-800">
                    <div className="bg-gray-800 text-white p-4 flex justify-between items-center shadow-md">
                        <div className="font-bold text-lg">{isListening ? 'ğŸ§ è½åŠ›' : 'ğŸ“– é–±è®€'}</div>
                        <div className={`font-mono text-xl font-bold ${timeLeft < 60 ? 'animate-timer' : 'text-green-400'}`}>
                            {Math.floor(timeLeft / 60)}:{String(timeLeft % 60).padStart(2, '0')}
                        </div>
                    </div>
                    <div className="w-full bg-gray-300 h-2"><div className="bg-blue-600 h-2 transition-all duration-300" style={{ width: `${((currentIndex) / 20) * 100}%` }}></div></div>
                    <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                        <div className="mb-8 h-32 flex flex-col items-center justify-center">
                            {isListening ? (
                                <button onClick={() => playAudio(currentQ.thai)} className="w-24 h-24 rounded-full bg-yellow-100 border-4 border-yellow-400 flex items-center justify-center text-4xl shadow-lg hover:scale-105 transition">ğŸ”Š</button>
                            ) : (
                                <h2 className="text-5xl md:text-6xl font-bold text-gray-800">{currentQ.thai}</h2>
                            )}
                        </div>
                        <div className="grid grid-cols-1 gap-3 w-full max-w-md">
                            {options.map((opt, idx) => (
                                <button key={idx} onClick={() => handleAnswer(opt.meaning)} className="p-4 bg-white border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 font-bold text-lg transition shadow-sm text-left">
                                    <span className="mr-2 text-gray-300">{String.fromCharCode(65 + idx)}.</span> {opt.meaning}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // [é é¢] æ¨¡æ“¬è€ƒ - çµæœ
        const ExamResultScreen = ({ results, onHome }) => {
            const score = results.filter(r => r.isCorrect).length;
            const percentage = Math.round((score / results.length) * 100);
            const passed = percentage >= 60; 

            return (
                <div className="h-full bg-gray-50 overflow-y-auto p-4">
                    <div className="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
                        <div className={`p-8 text-center ${passed ? 'bg-green-600' : 'bg-red-600'} text-white`}>
                            <h2 className="text-3xl font-bold mb-1">{passed ? 'é€šé (Passed)' : 'æœªé€šé (Failed)'}</h2>
                            <div className="text-6xl font-black mt-4">{score} <span className="text-2xl font-normal opacity-70">/ {results.length}</span></div>
                        </div>
                        <div className="p-6">
                            <h3 className="font-bold text-gray-700 mb-4 border-b pb-2">éŒ¯é¡Œæª¢è¨</h3>
                            <div className="space-y-4">
                                {results.map((r, idx) => !r.isCorrect && (
                                    <div key={idx} className="flex items-start gap-4 p-3 bg-red-50 rounded-lg border border-red-100">
                                        <div className="bg-white p-2 rounded text-center min-w-[3rem] font-bold">{r.question.type === 'listening' ? 'ğŸ”Š' : r.question.thai}</div>
                                        <div className="text-sm">
                                            <div className="text-green-600 font-bold">æ­£è§£: {r.question.meaning} <span className="text-xs text-gray-400">({r.question.thai})</span></div>
                                            <div className="text-red-400 line-through">èª¤é¸: {r.userChoice}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="p-6 bg-gray-50 border-t text-center">
                            <button onClick={onHome} className="px-8 py-3 bg-gray-800 text-white rounded-full font-bold shadow-lg">å›é¦–é </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. ä¸»ç¨‹å¼è·¯ç”± ---
        function App() {
            const [view, setView] = useState('home');
            const [examResults, setExamResults] = useState(null);

            const finishExam = (results, questions) => {
                const completeResults = [...results];
                if (results.length < questions.length) {
                    for (let i = results.length; i < questions.length; i++) {
                        completeResults.push({ question: questions[i], userChoice: 'é€¾æ™‚', isCorrect: false });
                    }
                }
                setExamResults(completeResults);
                setView('examResult');
            };

            return (
                <div className="h-full w-full max-w-md mx-auto bg-white shadow-2xl overflow-hidden">
                    {view === 'home' && <HomeScreen onStart={setView} />}
                    {view === 'alphabet' && <AlphabetScreen onBack={() => setView('home')} />}
                    {view === 'rules' && <RulesScreen onBack={() => setView('home')} />}
                    {view === 'learn' && <LearnScreen onBack={() => setView('home')} />}
                    {view === 'quiz' && <PracticeQuizScreen onBack={() => setView('home')} />}
                    {view === 'examIntro' && <ExamIntroScreen onStart={() => setView('exam')} onBack={() => setView('home')} />}
                    {view === 'exam' && <ExamScreen onFinish={finishExam} />}
                    {view === 'examResult' && <ExamResultScreen results={examResults} onHome={() => setView('home')} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>